---
title: νμ΄μ¬μΌλ΅ νƒμƒ‰μ  μ”μΈλ¶„μ„, μ‹ λΆ°λ„ λ¶„μ„ν•κΈ°
date: 2020-01-21
categories: [WORK, π“ Data]
tags: [λ°μ΄ν„°λ¶„μ„, Python, μ‹¬λ¦¬ν•™]
---

κ·Έλ™μ• μ‹¬λ¦¬ν•™μ„ λΉ„λ΅―ν• μ‚¬νκ³Όν•™ λ¶„μ•Όμ—μ„ μ—°κµ¬ν•  λ• κ°€μ¥ λ§μ΄ μ“°λ ν†µκ³„ ν”„λ΅κ·Έλ¨μ€ SPSSμ€λ‹¤.

μµκ·Όμ— νμ‚¬μ—μ„ μ‹¬λ¦¬κ²€μ‚¬ κ²°κ³Όλ¥Ό κ°€μ§€κ³  μ΄κ² μ λ§λ“¤μ–΄μ§„ κ²€μ‚¬μΈμ§€ κ²€μ¦ν•κΈ° μ„ν• ν†µκ³„λ¶„μ„, κµ¬μ²΄μ μΌλ΅λ”Β νƒμƒ‰μ  μ”μΈλ¶„μ„(EFA: Exploratory Factor Analysis)κ³ΌΒ μ‹ λΆ°λ„ κ³„μ(Cronbachβ€™s alpha)λ¥Ό ν™•μΈν•λ” μ‘μ—…μ„ ν•  μΌμ΄ μμ—λ”λ°, λ‚ SPSSκ°€ μ—†μ–΄μ„ νμ΄μ¬μΌλ΅ ν•΄κ²°ν–λ‹¤.

μ½”λ“ μμ‹λ¥Ό κ°„λµν λ©”λ¨ μ°¨μ›μ—μ„ λ‚¨κ²¨λ΄μ•Όκ² λ‹¤.

## μ¤€λΉ„

νμ΄μ¬μΌλ΅ λ°μ΄ν„° λ¶„μ„ μΆ€ ν•΄λ³Έ μ‚¬λλ“¤μ΄λΌλ©΄ numpy, pandas, matplotlib, seabornκΉμ§€λ” λ€λ¶€λ¶„ μ„¤μΉν–μ„ κ±°λ‹¤. μ•„, κ·Έλ¦¬κ³  jupyter notebookλ„.

μ΄λ²μ—λ” β€μ”μΈλ¶„μ„β€™μ„ μ„ν• ν¨ν‚¤μ§€Β [factor-analyzer](https://pypi.org/project/factor-analyzer/)κΉμ§€ μ„¤μΉν•΄μ£Όμ.

μ„¤μΉ λ°©λ²•μ€ λμƒ κ·Έλ ‡λ“―.

```
pip install factor-analyzer
```

## λ¶„μ„ μ½”λ“ μμ‹

### λ°μ΄ν„° μ‚΄ν΄λ³΄κΈ°

μΌλ‹¨ ν•„μ”ν• λΌμ΄λΈλ¬λ¦¬ λ¶λ¬μ¤κ³ , μ—‘μ…€λ΅ μ €μ¥λ νμΌμ„ pandas λ°μ΄ν„°ν”„λ μ„ ν•νƒλ΅ λ¶λ¬μ™”λ‹¤.

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

df = pd.read_excel("data.xlsx")
```


### λ¬Έν•­ λ¦¬μ¤νΈ μ¤€λΉ„ν•κΈ°

κ° λ¬Έν•­λ“¤μ€ λ¨λ‘ 1~5μ  λ¦¬μ»¤νΈ μ²™λ„λ΅ κµ¬μ„±λμ—λ‹¤.

λ¶„μ„μ— μ•μ„ λ¬Έν•­λ“¤μ„ λ‚΄κ°€ μ• μ΄μ— μ„¤κ³„ν• μ”μΈ κµ¬μ΅°μ— λ”°λΌ μΆ€ λ¬¶μ–΄λ†“μ„ ν•„μ”κ°€ μλ‹¤.

μΌλ‹¨ μ—΄(μ»¬λΌ) μ΄λ¦„μ„ λ½‘μ•„λ³΄λ©΄

```python
df.columns
```

```
Index(['respondent-id', 'sex', 'a-1', 'b-1', 'c-1', 'd-1', 'e-1', 'f-1', 'g-1', 'h-1', 'a-2', 'b-2', 'c-2', 'd-2', 'e-2', 'f-2', 'g-2', 'h-2', 'a-3', 'b-3', 'c-3', 'd-3', 'e-3', 'f-3', 'g-3', 'h-3'], dtype='object')
```

μ΄λ° λ¨μ–‘μƒλ‹¤. μ•μ— μκ²€μ λ²νΈμ™€ μ„±λ³„ λΉΌκ³  λ’· λ¶€λ¶„ 24κ°κ°€ λ¬Έν•­μ΄λ‹¤.

μ• μ΄μ— aλ¶€ν„° hκΉμ§€ μ΄ 8κ°μ μ”μΈ, μ”μΈλ‹Ή 3κ° λ¬Έν•­μΌλ΅ κµ¬μ„±λλ„λ΅ ν•΄λ†“μ•λ‹¤.

μ΄κ±Έ λ¦¬μ¤νΈ ν•νƒλ΅ λ³€ν™ν•΄μ„ itemsλΌλ” λ³€μμ— λ‹΄μ•„μ£Όκ³  μ •λ ¬μ„ ν•΄λ†“μ.

```python
items = df.columns.tolist()[2:]
items.sort()
```

```
['a-1', 'a-2', 'a-3', 'b-1', 'b-2', 'b-3', 'c-1', 'c-2', 'c-3', 'd-1', 'd-2', 'd-3', 'e-1', 'e-2', 'e-3', 'f-1', 'f-2', 'f-3', 'g-1', 'g-2', 'g-3', 'h-1', 'h-2', 'h-3']
```

μ΄μ  μ›λ λ°μ΄ν„°ν”„λ μ„ dfμ—μ„ itemsμ— μλ” μ»¬λΌλ“¤μ κ°’μ„ κ°€μ Έμ™€ μ”μΈλ¶„μ„μ„ λλ¦΄ κ±°λ‹¤.

### νƒμƒ‰μ  μ”μΈλ¶„μ„(EDA) μν–‰ν•κΈ°

μΌλ‹¨ μ•„κΉ μ„¤μΉν–λ λΌμ΄λΈλ¬λ¦¬λ¥Ό ν• λ² λ¶λ¬μ™€λ³΄μ.

```python
from factor_analyzer import FactorAnalyzer
```

κ·Έλ¦¬κ³  μ”μΈλ¶„μ„ λ¨λΈμ„ λ¶λ¬μ¨λ‹¤. λ¶λ¬μ¬ λ• μ”μΈ κ°μ, νμ „ λ°©λ²• λ“±μ„ μ„ νƒν•  μ μλ”λ°, μΌλ‹¨ μ”μΈ κ°μλ” 8κ°, μµλ€μ°λ„λ°©λ²•, promax νμ „μΌλ΅ λλ ¤λ³Ό κ±°λ‹¤. (νλΌλ―Έν„° μ„¤μ •μ— λ€ν•΄ μΆ€ λ” μμ„Έν μ•κ³  μ‹¶λ‹¤λ©΄Β [FactorAnalyzer github](https://github.com/EducationalTestingService/factor_analyzer)λ¥Ό μ°Έκ³ ν•μ.)

```python
fa = FactorAnalyzer(n_factors=8, method="ml", rotation="promax")
fa.fit(df[items])
```

κ·Έλ¦¬κ³  λ°©κΈ λ°μ΄ν„° λ„£κ³  λλ¦΄ λ•Β `.fit()`μ΄λΌλ” μ΄λ¦„μ λ©”μ„λ“λ¥Ό μ‚¬μ©ν–λ”λ°, νμ΄μ¬μ λ¨Έμ‹ λ¬λ‹ scikit-learn λΌμ΄λΈλ¬λ¦¬ μ‚¬μ©ν•΄λ³Έ μ‚¬λμ€ μµμ™ν•  κ±°λ‹¤.

μ•„λ¬΄νΌ μ΄κ² λμ΄λ‹¤.

μ”μΈ λ¶€ν•λ‰μ€Β `fa.loadings_`λ¥Ό μ¶λ ¥ν•΄λ³΄λ©΄ ν™•μΈν•  μ μλ”λ°β€¦

```
array([[ 1.24276282e-01,  3.95265985e-01,  1.87318076e-01,
        -3.12377289e-02, -9.95634664e-02, -6.82004265e-02,
         1.74049220e-01, -2.75130028e-04],
       [-4.15189606e-03,  9.03954874e-01, -4.94827334e-02,
        -4.43622592e-03, -2.98582932e-02, -4.33654049e-02,
        -5.24262732e-02, -4.18444548e-02],
       [-7.78104868e-02,  8.85572048e-01, -8.07603310e-02,
         7.47079191e-02,  1.21708537e-03,  9.08425871e-02,
        -9.51157387e-02, -9.78357663e-02],

       ... (μ¤‘λµ) ...
       
       [-1.10158523e-01,  1.63145065e-01,  1.33565470e-01,
         1.10847724e-02,  2.22950841e-01,  5.53432143e-02,
        -3.05526090e-02,  1.73291420e-01]])
```

μ΄κ±Έ μ–΄λ–»κ² λ΄β€¦ κ·Έλ¬λ‹ pandas λ°μ΄ν„°ν”„λ μ„ ν•νƒλ΅ λ°”κΏ”λ³΄μ. μ΄λ• indexλ” μ•„κΉ μ •λ¦¬ν• items(λ¬Έν•­ λ²νΈ λ¦¬μ¤νΈ)λ¥Ό λ„£μ–΄μ£Όλ©΄ λλ‹¤.

```python
efa_result= pd.DataFrame(fa.loadings_, index=items)
```

μ΄κ±Έ κΉ”λ”ν•κ² μ‹κ°ν™” ν•κ³  μ‹¶λ‹¤λ©΄ seabornμΌλ΅ ννΈλ§µμ„ κ·Έλ¦¬λ©΄ λλ‹¤. (μ«μλ” μ†μ«μ  λ‘ λ²μ§Έ μλ¦¬κΉμ§€λ§ ν‘κΈ°λλ„λ΅ ν–λ‹¤.)

```python
plt.figure(figsize=(6,10))
sns.heatmap(efa_result, cmap="Blues", annot=True, fmt='.2f')
```

μΌλ‹¨ νƒμƒ‰μ  μ”μΈλ¶„μ„ λ°©λ²•μ€ μ—¬κΈ°κΉμ§€.

### μ‹ λΆ°λ„ κ³„μ(Cronbachβ€™s alpha) ν™•μΈν•κΈ°

κ° μ”μΈμ— ν• λ‹Ήν•΄λ†“μ€ λ¬Έν•­λ“¤μ„ λ¬¶μ–΄μ„ μ‹ λΆ°λ„ κ³„μ(Cronbachβ€™s alpha)λ„ ν• λ² ν™•μΈν•΄λ³΄μ.

μ΄κ±΄ λ­ λ³„λ„μ λΌμ΄λΈλ¬λ¦¬λ¥Ό μ„¤μΉν•  ν•„μ” μ—†μ΄ numpyλ΅ λ°”λ΅ κ³„μ‚°μ΄ κ°€λ¥ν•λ‹¤. λ„κµ°κ°€κ°€ μ‹ λΆ°λ„λ¥Ό κµ¬ν•λ” ν•¨μλ¥Ό λ§λ“¤μ–΄μ„Β [μ΄λ ‡κ²](https://stackoverflow.com/a/20799687)Β μ¬λ ¤λ†“μ•λ”λΌ.

```python
def CronbachAlpha(itemscores):
    itemscores = np.asarray(itemscores)
	itemvars = itemscores.var(axis=0, ddof=1)
	tscores = itemscores.sum(axis=1)
	nitems = itemscores.shape[1]
	return (nitems / (nitems-1)) * (1 - (itemvars.sum() / tscores.var(ddof=1)))
```

μ΄ ν•¨μλ” κ° λ¬Έν•­λ“¤μ μ μλ¥Ό μ„ΈνΈ(λ¦¬μ¤νΈμ λ¦¬μ¤νΈ νΉμ€ λ‹¤μ°¨μ› λ°°μ—΄)λ΅ λ„£μ–΄μ¤μ•Ό ν•λ” κ±°λΌβ€¦ μ•„κΉ μ¤€λΉ„ν•΄λ†“μ•λ λ¬Έν•­ λ²νΈ λ¦¬μ¤νΈ itemsλ¥Ό κ°€μ§€κ³  μ¤€λΉ„ν•΄λ³΄μ.

```python
factors = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h']
factors_items_dict = {}

for factor in factors:
	factors_items_dict[factor] = [x for x in items if x[0] == factor]
```

μΌλ‹¨ factors_items_dictλΌλ” λ”•μ…”λ„λ¦¬μ—λ‹¤κ°€ aλ¶€ν„° hκΉμ§€ μ”μΈμ— ν•΄λ‹Ήν•λ” λ¬Έν•­μ„ λ‹΄μ•λ‹¤. μ΄λ° λ¨μ–‘μƒλ‹¤.

```
{'a': ['a-1', 'a-2', 'a-3'],
 'b': ['b-1', 'b-2', 'b-3'],
 'c': ['c-1', 'c-2', 'c-3'],
 'd': ['d-1', 'd-2', 'd-3'],
 'e': ['e-1', 'e-2', 'e-3'],
 'f': ['f-1', 'f-2', 'f-3'],
 'g': ['g-1', 'g-2', 'g-3'],
 'h': ['h-1', 'h-2', 'h-3']}
```

μ΄μ  μ—¬κΈ°μ„ ν•λ‚μ”© λ¶λ¬μ™€μ„ μ‹ λΆ°λ„λ¥Ό μ°μ–΄λ³΄μ.

```python
for key, value in factors_items_dict.items():
	print(key)
	print(CronbachAlpha(df[value]))
	print()
```

```
a
0.7405101159919194

b
0.6434213337169863

c
0.7722376346207973

d
0.8132146902628883

e
0.6025806790180286

f
0.7797227511940578

g
0.7797358204347294

h
0.6488698703179792
```

μ”μΈ b, e, hλ” 0.7μ΄ μ• λλ” μμ¤€μ΄λ‹¤. λ‚λ¨Έμ§€ μ”μΈλ“¤μ€ κ½¤ μ¤€μν•λ„¤.

μΌλ‹¨ μ¤λμ€ μ—¬κΈ°κΉμ§€.

> ν†µκ³„λ¶„μ„μ€ νμ΄μ¬μΌλ΅ ν•©μ‹λ‹¤.